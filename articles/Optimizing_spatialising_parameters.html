<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Optimizing spatialising parameters • spatialising</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Optimizing spatialising parameters">
<meta property="og:description" content="spatialising">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spatialising</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Optimizing_spatialising_parameters.html">Optimizing spatialising parameters</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Nowosad/spatialising/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Optimizing_spatialising_parameters_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Optimizing spatialising parameters</h1>
                        <h4 data-toc-skip class="author">Jakub Nowosad</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Nowosad/spatialising/blob/HEAD/vignettes/Optimizing_spatialising_parameters.Rmd" class="external-link"><code>vignettes/Optimizing_spatialising_parameters.Rmd</code></a></small>
      <div class="hidden name"><code>Optimizing_spatialising_parameters.Rmd</code></div>

    </div>

    
    
<p>The <strong>spatialising</strong> package allows to perform a kinetic Ising model simulation of an observed change in a binary land pattern between <em>t1</em> and <em>t2</em>. The goal is to find the values of two free parameters of the Ising model, <code>B</code> and <code>J</code>, under which the simulated pattern, identical to the observed pattern at <em>t1</em>, will advance to the simulated pattern at <em>t2</em> that is very close to the observed pattern at <em>t2</em>.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Let’s start by attaching two packages: <strong>terra</strong> (for reading and processing raster data) and <strong>spatialising</strong>, and read two datasets: <code>maine2013</code> and <code>maine2016</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jakubnowosad.com/spatialising/" class="external-link">spatialising</a></span><span class="op">)</span></span>
<span><span class="va">maine2013</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/maine2013.tif"</span>, package <span class="op">=</span> <span class="st">"spatialising"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">maine2016</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/maine2016.tif"</span>, package <span class="op">=</span> <span class="st">"spatialising"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>These rasters represent the same forested area in the state of Maine with 250 rows and columns. The <code>maine2013</code> raster represents the state in the year 2013, while the <code>maine2016</code> in 2016. Both of them have only two values: <code>1</code> for forest and <code>-1</code> for non-forest.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">maine2013</span>, <span class="va">maine2016</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Optimizing_spatialising_parameters_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>A careful look at the west part of the plot above reveals an increase in the forested area between 2013 and 2016.</p>
</div>
<div class="section level2">
<h2 id="metrics">Metrics<a class="anchor" aria-label="anchor" href="#metrics"></a>
</h2>
<p>For each of our rasters, we calculate two metrics: m index and texture index. The composition_index (<span class="math inline">\(m\)</span>) is the sum of all raster values divided by the number of cells. It has a range from <code>-1</code> to <code>1</code>, where <code>-1</code> means that all cells have value <code>-1</code> and <code>1</code> means that all cells have value <code>1</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/composition_index.html">composition_index</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">maine2013</span>, <span class="va">maine2016</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.036640 0.065664</span></span></code></pre></div>
<p>Here, we can see an increase in the values of the m index between 2013 and 2016, which means that the forested area (<code>1</code>) had increased.</p>
<p>The texture index (<span class="math inline">\(t\)</span>) is an average over the entire site of the values of neighboring cells. It has a range from <code>0</code> to <code>1</code>, where <code>0</code> is a smooth, fine texture, and <code>1</code> is a coarse texture.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/texture_index.html">texture_index</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">maine2013</span>, <span class="va">maine2016</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7423454 0.7548273</span></span></code></pre></div>
<p>The values of texture index also increased between the studied years, but to a much lesser degree.</p>
</div>
<div class="section level2">
<h2 id="simulations">Simulations<a class="anchor" aria-label="anchor" href="#simulations"></a>
</h2>
<p>Now, we could try to simulate the state in the year 2016 using the <code>maine2013</code> raster as a reference with the <code><a href="../reference/kinetic_ising.html">kinetic_ising()</a></code> function. It requires the input raster (<code>x</code>), the strength of the external pressure (<code>B</code>), the strength of the local autocorrelation tendency (<code>J</code>), and also has some optional arguments, such as the number of iterations (<code>iter</code>), and the inertia (<code>inertia</code>).</p>
<p>The simulation proceeds with one randomly selected cell at a time. The selected cell is given an opportunity to flip its value (<code>1</code> to <code>-1</code> or <code>-1</code> to <code>1</code>). The probability of a flip depends on the value of the cell and the values of its four neighbors (top, left, bottom, and right). It also depends on the values of <code>B</code> and <code>J</code>. <code>B</code> (positive or negative) is an external pressure: it tries to align cells’ values with its sign. <code>J</code> (always positive) is a strength of the local autocorrelation tendency: it tries to align signs of neighboring cells.<br>
The <code>iter</code> argument controls the number of iterations (how many times the flip of a cell value is attempted). By default, its value is set to the number of cells in the input raster, however, as in this case there were three years between the studied years, we can set it to three times the number of cells. The last parameter, <code>inertia</code> (by default <code>0</code>), when positive makes it less possible for a cell of <code>-1</code> to change its value to <code>1</code> when surrounded by other <code>-1</code> cells. As the effect, it minimizes the possibility of a “salt and pepper” effect, where cells of different values are mixed together.</p>
<p>In our example of reforestation, we could assume that the value of <code>B</code> should be positive, as the forested area increased between 2013 and 2016. We could also make an assumption that the value of <code>J</code> should be positive, as many environmental spatial processes express some kind of spatial autocorrelation. At this point, however, the question is: what should be the values of <code>B</code> and <code>J</code>? We may start by trying different values of <code>B</code> and <code>J</code> to see which combination of them results in the best simulation and to gather some kind of intuition regarding these values.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim1</span> <span class="op">=</span> <span class="fu"><a href="../reference/kinetic_ising.html">kinetic_ising</a></span><span class="op">(</span><span class="va">maine2013</span>, B <span class="op">=</span> <span class="fl">0.3</span>, J <span class="op">=</span> <span class="fl">0.9</span>, iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">maine2013</span><span class="op">)</span> <span class="op">*</span> <span class="fl">3</span>, inertia <span class="op">=</span> <span class="fl">150</span><span class="op">)</span></span>
<span><span class="va">sim2</span> <span class="op">=</span> <span class="fu"><a href="../reference/kinetic_ising.html">kinetic_ising</a></span><span class="op">(</span><span class="va">maine2013</span>, B <span class="op">=</span> <span class="fl">0.7</span>, J <span class="op">=</span> <span class="fl">0.1</span>, iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">maine2013</span><span class="op">)</span> <span class="op">*</span> <span class="fl">3</span>, inertia <span class="op">=</span> <span class="fl">150</span><span class="op">)</span></span></code></pre></div>
<p>The plot below shows our two simulations. The left one represents a visible increase in the forested area, while keeping these areas spatially coherent. The right one, on the other hand, represents a larger, but also a more “chaotic” increase in the forested area.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim1</span>, <span class="va">sim2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Optimizing_spatialising_parameters_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>To make a numerical decision on which simulation is better, we can calculate the metrics for each of them and compare them with the metrics of the <code>maine2016</code> raster.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maine2016_metrics</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/composition_index.html">composition_index</a></span><span class="op">(</span><span class="va">maine2016</span><span class="op">)</span>, <span class="fu"><a href="../reference/texture_index.html">texture_index</a></span><span class="op">(</span><span class="va">maine2016</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim1_metrics</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/composition_index.html">composition_index</a></span><span class="op">(</span><span class="va">sim1</span><span class="op">)</span>, <span class="fu"><a href="../reference/texture_index.html">texture_index</a></span><span class="op">(</span><span class="va">sim1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim2_metrics</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/composition_index.html">composition_index</a></span><span class="op">(</span><span class="va">sim2</span><span class="op">)</span>, <span class="fu"><a href="../reference/texture_index.html">texture_index</a></span><span class="op">(</span><span class="va">sim2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The two metrics for a given pattern can be viewed as a metric point (<em>metric1</em>, <em>metric2</em>). Then, a the Euclidean “distance” between two patterns in terms of these two metrics is <em>[(metricA1-metricB1)^2 +{metricA2-metricB2)^2]^(1/2)</em>. We can now calculate distance (dissimilarity) between the <code>maine2016</code> pattern (a target of the simulation) and two simulated candidate patterns (see below).</p>
<p>Here, we join all of the resulting metrics into a single matrix and calculate the Euclidean distance between the metrics of the <code>maine2016</code> raster and the metrics of each of the simulations using the <code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist()</a></code> function. The smaller the distance, the more simulation is similar to the <code>maine2016</code> raster.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_metrics</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">maine2016_metrics</span>, <span class="va">sim1_metrics</span>, <span class="va">sim2_metrics</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">all_metrics</span><span class="op">)</span></span>
<span><span class="co">#&gt;              maine2016_metrics sim1_metrics</span></span>
<span><span class="co">#&gt; sim1_metrics         0.1330533             </span></span>
<span><span class="co">#&gt; sim2_metrics         0.4179182    0.4207408</span></span></code></pre></div>
<p>Clearly the simulated candidate pattern generated with <code>B = 0.3</code> and <code>J = 0.9</code> is a better match to the target.</p>
</div>
<div class="section level2">
<h2 id="optimization">Optimization<a class="anchor" aria-label="anchor" href="#optimization"></a>
</h2>
<p>We could now try many different combinations of <code>B</code> and <code>J</code> values and compare the results, but this would be a tedious task. Instead, we can use the <strong>optimization</strong> package to find the best combination of <code>B</code> and <code>J</code> values using a technique called <em>simulated annealing</em>. The main function in this package, <code><a href="https://rdrr.io/pkg/optimization/man/optim_sa.html" class="external-link">optim_sa()</a></code>, requires the input function (<code>fun</code>), the starting values (<code>start</code>), and the lower (<code>lower</code>) and upper (<code>upper</code>) bounds for the values. The <code>fun</code> function must take only one input and return a single value.</p>
<p>In our case, the <code><a href="https://rdrr.io/pkg/optimization/man/optim_sa.html" class="external-link">optim_sa()</a></code> function will try to find the best combination of <code>B</code> and <code>J</code> values that minimize the output value of the <code>fun</code> function. We will use <code>optimize_model()</code> as the input function. It takes a vector <code>x</code> of two values (proposed <code>B</code> and <code>J</code>), runs the <code><a href="../reference/kinetic_ising.html">kinetic_ising()</a></code> function with these values, calculates the metrics for the resulting raster, and calculates the Euclidean distance between the metrics of the resulting raster and the metrics of the <code>maine2016</code> raster.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optimize_model</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">sim</span> <span class="op">=</span> <span class="fu">spatialising</span><span class="fu">::</span><span class="fu"><a href="../reference/kinetic_ising.html">kinetic_ising</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">maine2013</span>, B <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, J <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>                                    iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">maine2013</span><span class="op">)</span> <span class="op">*</span> <span class="fl">3</span>, inertia <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>  </span>
<span>  <span class="va">maine2016_metrics</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/composition_index.html">composition_index</a></span><span class="op">(</span><span class="va">maine2016</span><span class="op">)</span>, <span class="fu"><a href="../reference/texture_index.html">texture_index</a></span><span class="op">(</span><span class="va">maine2016</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">sim_metrics</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/composition_index.html">composition_index</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span>, <span class="fu"><a href="../reference/texture_index.html">texture_index</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span><span class="op">)</span>             </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">maine2016_metrics</span>, <span class="va">sim_metrics</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now, we can run the <code><a href="https://rdrr.io/pkg/optimization/man/optim_sa.html" class="external-link">optim_sa()</a></code> function. Here, we will set the starting values of <code>B</code> and <code>J</code> to <code>0</code>, the lower bound of <code>B</code> to <code>-0.9</code> and <code>J</code> to <code>0</code>, and their upper bounds to <code>0.9</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kaihusmann/optimization" class="external-link">optimization</a></span><span class="op">)</span></span>
<span><span class="va">optim_params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/optimization/man/optim_sa.html" class="external-link">optim_sa</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">optimize_model</span>, </span>
<span>                        start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.9</span>, <span class="fl">0</span><span class="op">)</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/pkg/optimization/man/optim_sa.html" class="external-link">optim_sa()</a></code> function returns an object that contains the best combination of <code>B</code> and <code>J</code> values in the <code>par</code> element. In this case, the best combination found is <code>B = 0.09</code> and <code>J = 0.43</code>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optim_params</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="co">#&gt; [1] 0.09 0.44</span></span></code></pre></div>
<p>Now, we are able to run the <code><a href="../reference/kinetic_ising.html">kinetic_ising()</a></code> function with the best combination of <code>B</code> and <code>J</code> values.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_optim</span> <span class="op">=</span> <span class="fu"><a href="../reference/kinetic_ising.html">kinetic_ising</a></span><span class="op">(</span><span class="va">maine2016</span>, </span>
<span>                          B <span class="op">=</span> <span class="va">optim_params</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, J <span class="op">=</span> <span class="va">optim_params</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>                          iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">maine2013</span><span class="op">)</span> <span class="op">*</span> <span class="fl">3</span>, inertia <span class="op">=</span> <span class="fl">150</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_optim</span><span class="op">)</span></span></code></pre></div>
<p><img src="Optimizing_spatialising_parameters_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>We can also check the <code>function_value</code> element that represents the Euclidean distance between the metrics of the <code>maine2016</code> raster and the metrics of the raster generated with the best combination of <code>B</code> and <code>J</code> values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_optim_metrics</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/composition_index.html">composition_index</a></span><span class="op">(</span><span class="va">sim_optim</span><span class="op">)</span>, <span class="fu"><a href="../reference/texture_index.html">texture_index</a></span><span class="op">(</span><span class="va">sim_optim</span><span class="op">)</span><span class="op">)</span>             </span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">maine2016_metrics</span>, <span class="va">sim_optim_metrics</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0.03608596</span></span></code></pre></div>
<p>Finally, we can visually compare the rasters for the years 2013, 2016, and the simulation for 2016.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">maine2013</span>, <span class="va">maine2016</span>, <span class="va">sim_optim</span><span class="op">)</span>, nr <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Optimizing_spatialising_parameters_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>The results show that the <code>sim_optim</code> raster is fairly similar to the <code>maine2016</code>.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>You just need to be aware that simulated annealing is a stochastic algorithm, so the results may be slightly different each time you run it.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jakub Nowosad.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
